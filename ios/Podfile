# 1) Define dónde está tu SDK de Flutter
def flutter_root
  ENV['FLUTTER_ROOT'] || raise("FLUTTER_ROOT no encontrado")
end

# 2) Carga el helper que define flutter_install_all_ios_pods y flutter_post_install
require File.expand_path(
  File.join(flutter_root, 'packages', 'flutter_tools', 'bin', 'podhelper'),
  __FILE__
)

# 3) Hook inicial de Flutter
flutter_ios_podfile_setup

# 4) Ahora tu configuración habitual
platform :ios, '13.0'
ENV['COCOAPODS_DISABLE_STATS'] = 'true'

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  # Instala todos los pods de tus plugins Flutter
  flutter_install_all_ios_pods(__dir__)
end

# 5) Aquí ya existe flutter_post_install
post_install do |installer|
  # (Opcional) Forzar deployment target en cada pod:
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '13.0'
    end
  end

  # El hook estándar de Flutter
  flutter_post_install(installer)
end
