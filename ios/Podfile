platform :ios, '13.0'
ENV['COCOAPODS_DISABLE_STATS'] = 'true'

project 'Runner', 'Debug' => :debug, 'Profile' => :release, 'Release' => :release

# Directorio donde vive este Podfile (la carpeta ios)
flutter_application_path = __dir__

# Obtiene la ruta del SDK de Flutter desde la variable de entorno (Codemagic la provee)
def flutter_root
  ENV.fetch('FLUTTER_ROOT')
end

# Carga el helper oficial de Flutter para CocoaPods
require File.join(flutter_root, 'packages', 'flutter_tools', 'bin', 'podhelper')

# Ejecuta la configuración inicial de iOS (rutas de headers, flags, etc.)
flutter_ios_podfile_setup

target 'Runner' do
  # Usa frameworks estáticos para los plugins (necesario para encontrar Flutter.h)
  use_frameworks! :linkage => :static

  # Instala todos los pods de iOS de Flutter y de tus plugins
  flutter_install_all_ios_pods(flutter_application_path)
end

post_install do |installer|
  # Aplica los ajustes finales post-instalación que Flutter necesita
  flutter_post_install(installer)
end
